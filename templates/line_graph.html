<div style="width: 800px;">
    <canvas id="tempChart"></canvas>
    <canvas id="co2Chart"></canvas>
    <canvas id="humidChart"></canvas>
    <canvas id="presChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1"></script>
<script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@^1.3.1"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>


<script>
    // function to update the graph with new data
    function updateGraph(index) {
        document.getElementById('myRange').value=index
        // update the chart data
        chart.data.datasets[0].data = temp_data.slice(0, index);
        chart.data.labels = time_labels.slice(0, index);
        // update the chart
        chart.update();
    }
</script>

<script>
function prepend(value, array) {
    var newArray = array.slice();
    newArray.unshift(value);
    return newArray;
}

function getNewData(location){
    console.log(time_labels[0]);
    sensor = 'temperature'
    $.ajax({
        url: "{{url_for('get_new_data')}}",
        type: "GET",
        data: {'last_datapoint':time_labels[0], 'location':location, 'sensor_type':sensor},
        success: function(ret_data) {
            if (ret_data) {
                console.log(ret_data);
                console.log(ret_data['data'].length);
                for (var i = 0; i < ret_data['data'].length; i++) {
                    console.log(ret_data['data'][i]);
                    console.log(ret_data['timestamp'][i]);
                    chart.data.datasets[0].data = prepend(ret_data['data'][i], chart.data.datasets[0].data);
                    chart.data.labels = prepend(luxon.DateTime.fromISO(ret_data['timestamp'][i]), chart.data.labels);
                    chart.data.datasets[0].data.pop();
                    chart.data.labels.pop();
                    time_labels = prepend(ret_data['timestamp'][i], time_labels);
                }
                chart.update();
            }
        }
    });
}

myInterval = setInterval(function(){getNewData(1)}, 1000);
</script>

<script>
function getLatest(location) {
    $.ajax({
        url: "{{url_for('get_latest')}}",
        type: "GET",
        data: {'data':location},
        success: function(ret_data) {
            console.log(ret_data);
            document.getElementById("test1").innerHTML = ret_data;
        }
    });
}
</script>

<button type="submit" id="button4" name="button" onclick="updateGraph(10)" class="btn btn-primary">10</button>
<button type="submit" id="button5" name="button" onclick="updateGraph(50)" class="btn btn-primary">50</button>
<button type="submit" id="button6" name="button" onclick="updateGraph(100)" class="btn btn-primary">100</button>
<div><input type="range" min="1" max="100" value="50" class="slider" id="myRange" oninput="updateGraph(value)"></input>
</div>